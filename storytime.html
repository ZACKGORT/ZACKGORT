<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />  
  <!-- Base so that all relative URLs resolve to your repo’s raw content -->
  <base href="https://raw.githubusercontent.com/ZACKGORT/scroll/main/">
  <title>Layout Formation on Scroll | Codrops</title>

  <!-- GSAP core + plugins -->
  <script src="https://unpkg.com/gsap@3/dist/gsap.min.js"></script>
  <script src="https://unpkg.com/gsap@3/dist/ScrollTrigger.min.js"></script>
  <script src="https://unpkg.com/gsap@3/dist/Physics2DPlugin.min.js"></script>

  <!-- ImagesLoaded -->
  <script src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>

  <!-- Lenis smooth scroll -->
  <script src="https://unpkg.com/@studio-freight/lenis/dist/lenis.min.js"></script>

  <style>
/* =========================================================
   TOKENS / RESET
   ========================================================= */
*,
*::before,
*::after { box-sizing: border-box; }

:root{
  /* Canvas */
  --bg:#000;
  --color-bg:#0e0d0e;
  --color-bg-content:#0e0d0e;
  --color-bg-frame:#FF8DA1;

  /* Text & UI */
  --color-text:#f5f3ee;
  --color-text-alt:#d7d4cd;
  --color-label:#fff;
  --color-link:#fff;
  --color-link-hover:#fff;
  --color-border:#46443e;

  /* Layout */
  --page-padding:.75rem;
  --grid-gap:var(--page-padding);

  /* Effects */
  --cursor-size:28px;

  /* Blur overlay */
  --layers:5;
  --blur-max:40;
  --mask-stop:35;
  --saturate:.99; /* reset */

  /* Panel palette */
  --cs-accent:#f4d35e;
  --cs-deep:#000;
  --cs-warm:#f95738;
  --cs-soft:#ebebd3;
  --cs-ink:#2c241a;

  /* Typography defaults */
  --fs-xxs:12px;
  --fs-body:18px;

  /* Z */
  --z-blur: 1000;
  --z-footer: 1002;
}

html, body { width:100%; overflow-x:hidden; }
html { font-size: var(--fs-body); }
body{
  margin:0;
  color:var(--color-text);
  background:var(--color-bg);
  font-family:"area-variable",sans-serif;
  font-variation-settings:"slnt" 0,"wdth" 100,"wght" 450,"INKT" 0;
  font-weight:450;
  line-height:1.2;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}

/* Links & buttons */
a{ color:var(--color-link); text-decoration:none; outline:none; cursor:pointer; }
a:hover{ color:var(--color-link-hover); text-decoration:underline; }
a:focus{ outline:none; background:lightgrey; }
a:focus:not(:focus-visible){ background:transparent; }
a:focus-visible{ outline:2px solid red; background:transparent; }
.unbutton{ background:none; border:0; padding:0; margin:0; font:inherit; cursor:pointer; }

/* Microtype */
.type-tiny,
.cdawrap,
.page-footer,
.project__label{
  font-size:var(--fs-xxs);
  text-transform:uppercase;
  letter-spacing:.06em;
  font-weight:400;
  color:var(--color-label);
}

/* Right-edge helper (kept once) */
.type-tiny.right.end{
  text-align:left;
  max-width:364px;
  margin-inline-start:auto;
}

/* Inline link spacing & rows */
a + a { margin-inline-start:.6rem; }
.links--spaced{
  display:flex; flex-wrap:wrap;
  column-gap:clamp(.5rem,1.2vw,1rem); row-gap:.35rem;
}
.frame__links{
  display:flex; flex-wrap:wrap;
  gap:.35rem clamp(.5rem,1.2vw,1rem);
}
.frame__links a{
  display:inline-flex; align-items:center;
  padding:.25rem .55rem; border-radius:.35rem;
}

/* =========================================================
   LOADER
   ========================================================= */
.js .loading::before,
.js .loading::after{ content:""; position:fixed; z-index:1000; }
.js .loading::before{ inset:0; background:var(--color-bg); }
.js .loading::after{
  top:50%; left:50%; width:60px; height:60px; margin:-30px 0 0 -30px;
  border-radius:50%; opacity:.4; background:var(--color-link);
  animation:loaderAnim .7s linear infinite alternate forwards;
}
@keyframes loaderAnim{ to{ opacity:1; transform:scale3d(.5,.5,1); } }

/* =========================================================
   FRAME / HERO (mobile-first)
   ========================================================= */
.frame{
  padding:var(--page-padding);
  position:relative;
  display:grid;
  grid-row-gap:.5rem;
  grid-column-gap:2rem;
  justify-items:start;
  align-content:start;
  line-height:1;
  min-height:100svh;
  background:var(--color-bg-frame);
  text-transform:uppercase;
  grid-template-columns: auto auto;
  grid-template-rows: auto auto auto 1fr;
  grid-template-areas:
    "logo"
    "tags"
    "sponsor"
    "subline"
    "title";
}
.frame #cdawrap{ justify-self:start; }
.frame__logo{
  grid-area:logo;
  padding-bottom:.15rem;
  font-size:1.5rem;
  font-family:"bricolage-grotesque-48",sans-serif;
}
.frame__tags{ grid-area:tags; }
.frame__links{ grid-area:sponsor; }
.frame__subline{ grid-area:subline; }
.frame__title{
  grid-area:title;
  white-space:nowrap;
  font-size:clamp(2rem,20vw,20rem);
  margin:0;
  letter-spacing:-.05em;
  padding-top:.15em;
  font-weight:400;
  line-height:.55;
  text-indent:-.065em;
  word-spacing:.15em;
  font-family:"bricolage-grotesque-48",sans-serif;
}
.frame__title sup.title-sup{
  font-size:.35em; line-height:0; display:inline-block;
  vertical-align:baseline; transform:translateY(-.6em); letter-spacing:.04em;
}

/* =========================================================
   CONTENT WRAPPER
   ========================================================= */
.content{
  position:relative;
  min-height:100dvh;
  background:var(--color-bg-content);
  align-content:center;
}
.content--padded{ padding:var(--page-padding); }
.content--cutoff{ overflow:hidden; }

/* one-cell grid by default */
.content--full{
  display:grid;
  place-items:center;
  grid-template-areas:"main";
  grid-template-rows:100%;
  grid-template-columns:100%;
  min-height:100svh;
}

/* Brands/Agency sections: titles ABOVE grids (baked in base) */
#brands-grid.content--full,
#brands-grid-2.content--full{
  display:block;            /* stack children by DOM order */
  min-height:auto;
}
#brands-grid .grid-head,
#brands-grid-2 .grid-head{
  display:block; width:100%;
  text-align:center;
  margin:0 auto calc(var(--grid-gap) * 1.75);
  padding-inline:var(--page-padding);
}
#brands-grid .grid-head__title,
#brands-grid-2 .grid-head__title{
  display:inline-block; margin:0 auto; text-align:center;
}
#brands-grid .grid-head__subtitle,
#brands-grid-2 .grid-head__subtitle{ display:none; }

/* Content titles */
.content__title{
  grid-area:main;
  position:relative;
  display:flex;
  flex-direction:column;
  text-align:center;
  margin:4rem 0 2rem;
}
.content__title-main{
  font-size:clamp(2rem,7vw,4.5rem);
  line-height:1;
  margin:.5rem 0 0;
  font-weight:500;
  font-variation-settings:"wght" 500;
  text-wrap:balance;
  letter-spacing:-.025em;
}
.content__title-main + p{
  margin:0; max-width:100px;
  font-size:var(--fs-xxs);
  letter-spacing:.04em;
  color:var(--color-label);
}
.content__text{
  font-size:clamp(1.1rem,2.8vw,1.7rem);
  line-height:1.4;
  font-weight:400;
  letter-spacing:0;
  color:var(--color-text);
  margin:.6rem 0;
  text-wrap:balance;
}

/* =========================================================
   GRID SYSTEM
   ========================================================= */
.grid{
  grid-area:main;
  display:grid;
  width:100%;
  height:100%;
  grid-template-columns:repeat(8,1fr);
  grid-template-rows:1fr 1fr 1fr;
  margin-bottom:1em;
}
.grid--spaced{ gap:var(--grid-gap); }
.grid--columns{
  grid-template-columns:repeat(5,1fr);
  grid-template-rows:repeat(2,min-content);
  align-content:center;
}
.grid--zoomed{
  gap:2rem;
  grid-template-columns:repeat(3,70%);
  grid-template-rows:repeat(3,60%);
  justify-content:center;
  align-content:center;
  aspect-ratio:2/1;
}
.grid--single{ height:auto; justify-self:center; }
.grid--column{
  grid-template-columns:repeat(15, calc((100% - 14 * 10px) / 15));
  gap:10px; grid-auto-rows:auto;
}
.grid--small{ grid-template-columns:repeat(9,1fr); grid-auto-rows:1fr; }
.grid--tiny{
  height:60vh;
  grid-template-columns:repeat(14,1fr);
  grid-auto-rows:auto;
}
.grid--wide{
  grid-template-columns:repeat(5,1fr);
  grid-template-rows:repeat(4,1fr);
}

/* Tiles */
.grid__img,
.grid__item{
  width:100%;
  min-height:200px;
  background-size:cover;
  background-position:50% 50%;
  pointer-events:none;
  will-change:transform;
}
.grid__img{ position:relative; overflow:hidden; }
.grid__img-inner{
  position:absolute; inset:0;
  width:100%; height:100%;
  background-size:cover;
  background-position:50% 50%;
  will-change:transform;
}
.grid__item{
  display:flex; flex-direction:column; justify-content:center;
  padding:.5rem;
}

/* Helpers */
.ar-wide{ aspect-ratio:4/3; }
.ar-narrow{ aspect-ratio:2/3; }
.ar-rect{ aspect-ratio:1; }
.span-2{ grid-column:auto / span 2; }
.span-3{ grid-column:auto / span 3; }
.center{ text-align:center; }
.right{ text-align:right; }
.end{ align-self:end; }
.acenter{ align-self:center; }

/* Work grid: only H4 link clickable */
#work .grid__item{ pointer-events:none; }
#work .grid__item .title-link{ pointer-events:auto; text-decoration:none; }
#work .grid__item .title-link:hover{ text-decoration:underline; }

/* =========================================================
   PROJECT BLOCKS
   ========================================================= */
.project{
  padding:1rem;
  max-width:1000px;
  margin:20vh auto;
  display:grid;
  grid-column-gap:7vw;
  grid-row-gap:.5rem;
}
.project--intro{
  grid-template-columns:1fr;
  grid-template-areas:
    "label-name" "name" "label-date" "date"
    "title" "label-mission" "mission";
}
.project--details{
  grid-template-areas:"label-default" "paragraph";
  grid-template-columns:1fr;
}
.project--left{ justify-content:start; }
.project--right{ justify-content:end; }
.project--details p{ grid-area:paragraph; max-width:400px; }
.project__label--default{ grid-area:label-default; }
.project p,
.grid__item p{
  font-size:1rem; line-height:1.4; margin:0; color:var(--color-text-alt);
}
.project__label--name{ grid-area:label-name; }
.project__label--date{ grid-area:label-date; }
.project__label--mission{ grid-area:label-mission; }
.project__name{ grid-area:name; }
.project__date{ grid-area:date; }
.project__mission{ grid-area:mission; line-height:1.4; }
.project__mission p{ color:var(--color-text-alt); }
.project__title{
  grid-area:title;
  font-size:clamp(2rem,13vw,8rem);
  font-weight:400;
  margin:10vh 0;
  line-height:1;
}
.project__heading{
  color:var(--color-label);
  font-weight:inherit;
  font-size:inherit;
  margin:0;
}

/* 2-up process wrapper (base = 1-col, desktop in MQ) */
[id$="-process"]{
  display:grid;
  grid-template-columns:1fr;
  gap:2rem 3rem;
  align-items:start;
}
[id$="-process"] > .project{ margin:0; padding:0; }
[id$="-process"] .project--details p{ max-width:none; }
[id$="-process"] .project__label{
  letter-spacing:.04em; text-transform:uppercase; opacity:.85;
}

/* Intro helper note */
.intro__info{
  position:fixed; left:50%;
  bottom:clamp(12px,4vh,32px);
  transform:translateX(-50%);
  z-index:1000;
  font-size:var(--fs-xxs);
  letter-spacing:.08em;
  text-transform:uppercase;
  opacity:.75;
  pointer-events:none;
}

/* Intro section */
.intro{
  min-height:100vh;
  display:grid; place-items:center;
  padding:var(--page-padding);
  background:linear-gradient(0deg, transparent, var(--color-bg-content));
}
.intro__title{ margin:0; line-height:.9; text-align:center; font-weight:400; }
.intro__title-pre{
  font-weight:300; font-size:clamp(2rem,8vw,5rem);
  color:var(--color-text); text-transform:uppercase;
}
.intro__title-sub{ font-size:clamp(1.5rem,20vw,8rem); max-width:15ch; margin:0 auto; }

/* Skills */
#skills .trio-grid{
  display:grid; grid-template-columns:repeat(3, minmax(0,1fr));
  gap:clamp(1rem,3vw,2rem); align-items:start;
}
#skills .trio-col h4{ margin:0 0 .5rem; }
#skills .trio-col .content__text{ margin:.15rem 0; }

/* =========================================================
   PANEL (OVERLAY)
   ========================================================= */
.panel{ font-feature-settings:"liga","kern"; letter-spacing:0; }
.panel .chapter{
  font-size:var(--fs-xxs); text-transform:uppercase; letter-spacing:.08em;
  opacity:.85; color:#cfcac0; margin-bottom:.5rem;
}
.panel .title{
  font-weight:400; line-height:.95; letter-spacing:-.02em;
  text-transform:uppercase; font-size:clamp(2rem,6.5vw,5rem); margin:.2rem 0 .6rem;
}
.panel .text{ font-size:1.05rem; line-height:1.5; color:#ddd7cd; }
.panel .text p{ margin:0 0 .85rem; }

.split-text .word{ display:inline-block; overflow:hidden; }
.split-text .word > span{ display:inline-block; transform:translateY(110%); opacity:0; }

.frosted-glass{
  --bg:rgba(18,18,18,.42);
  background:var(--bg);
  border:1px solid rgba(255,255,255,.08);
  border-radius:18px;
  padding:1.1rem 1.25rem;
  backdrop-filter:saturate(135%) blur(12px);
  -webkit-backdrop-filter:saturate(135%) blur(12px);
  box-shadow:0 8px 24px rgba(0,0,0,.22), inset 0 1px 0 rgba(255,255,255,.05);
}
.panel-content-blur-edges{
  -webkit-mask-image:radial-gradient(120% 100% at 50% 50%, #000 60%, transparent 100%);
          mask-image:radial-gradient(120% 100% at 50% 50%, #000 60%, transparent 100%);
}

.panel .panel-full,
.panel .hero-img,
.panel .banner-img,
.panel .concept-img{ position:relative; }
.panel .panel-full::after,
.panel .hero-img::after,
.panel .banner-img::after,
.panel .concept-img::after{
  content:""; position:absolute; inset:0;
  background:
    radial-gradient(140% 100% at 50% 50%, transparent 55%, rgba(0,0,0,.35) 100%),
    linear-gradient(to bottom, rgba(0,0,0,.18), transparent 25%, transparent 75%, rgba(0,0,0,.18));
  pointer-events:none;
}

.panel .intro{ background:var(--cs-deep); color:#f6f6f6; }
.panel .header{ background:var(--cs-accent); color:#421c06; }
.panel .about{ background:var(--cs-warm); color:#2f0e08; }
.panel .story{ background:#ee964b; color:#3f170b; }
.panel .outro{ background:var(--cs-soft); color:var(--cs-ink); }

.panel .about .row{ display:flex; gap:2rem; align-items:flex-start; width:100%; }
.panel .about .row .copy{ flex:3; }
.panel .about .row .img{ flex:3; }
.panel .about .row .img img{ border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,.25); }

.panel__progress-bar{ height:6px; background:linear-gradient(90deg, #fff 0%, rgba(255,255,255,.8) 100%); opacity:.85; }
.panel__counter h1{ font-size:clamp(18px,2.2vw,28px); letter-spacing:.06em; font-weight:500; color:#fff; opacity:.9; }

/* =========================================================
   STACKED GALLERIES
   ========================================================= */
.stacked-section{ position:relative; z-index:0; isolation:isolate; contain:paint; }
.content--full.stacked-section{ display:block; height:auto; min-height:0; }
.stacked-gallery{ display:grid; justify-items:center; }
.stacked-img{ width:min(1400px, 90vw); margin-inline:auto; }
.stacked-img img{
  display:block; width:100%; height:min(88vh, 900px);
  object-fit:cover; object-position:center center;
  backface-visibility:hidden; transform:translateZ(0); -webkit-transform:translateZ(0);
}

/* Stack hooks */
#fintech-stack, #ecommerce-stack{}

/* Fintech insight */
#fintech-insight{
  display:grid;
  grid-template-columns:repeat(2, minmax(0,1fr));
  gap:2rem 3rem;
  align-items:start;
  padding:var(--page-padding);
}
#fintech-insight .project.project--details{ margin:0; padding:0; display:block; }
#fintech-insight .project--details p{ max-width:none; }
#fintech-insight .project__label{ letter-spacing:.04em; text-transform:uppercase; opacity:.85; }

/* Fintech discovery width guard */
#fintech-discovery .grid.grid--zoomed{
  width:100vw; max-width:100vw; margin-inline:auto;
  gap:var(--grid-gap);
  grid-template-columns:repeat(3,1fr);
  grid-template-rows:repeat(3, minmax(0,1fr));
  aspect-ratio:auto;
}

/* Seventh grid padding tweak */
[data-grid-seventh] .grid__item.span-3{ padding-block:1.5rem; }

/* =========================================================
   FOOTER
   ========================================================= */
.page-footer{
  padding:var(--page-padding);
  display:grid; width:100%;
  grid-row-gap:1rem; grid-column-gap:2rem;
  justify-items:start; margin-top:40vh;
  grid-template-columns:auto; justify-content:space-between;
  position:relative; z-index:var(--z-footer);
}

/* =========================================================
   SCROLL INDICATOR
   ========================================================= */
.scroll-downs{
  position:fixed; left:50%; transform:translateX(-50%) scale(.5);
  transform-origin:50% 100%;
  bottom:clamp(20px,10vh,40px);
  width:34px; height:55px;
  z-index:9999;
  pointer-events:auto; cursor:pointer;
  filter:drop-shadow(0 2px 8px rgba(0,0,0,.35));
}
.mousey{
  width:3px; padding:10px 15px; height:35px;
  border:2px solid #fff; border-radius:25px; opacity:.75; box-sizing:content-box;
}
.scroller{
  width:3px; height:10px; border-radius:25%;
  background-color:#fff; animation:scroll 2.2s cubic-bezier(.15,.41,.69,.94) infinite;
}
@keyframes scroll{
  0%{opacity:0} 10%{transform:translateY(0); opacity:1} 100%{transform:translateY(15px); opacity:0}
}
.panel[aria-hidden="false"] ~ .scroll-downs{ opacity:0; visibility:hidden; }
.scroll-downs::after{
  content:"Back to top";
  position:absolute; left:50%; bottom:100%;
  transform:translate(-50%, -8px);
  font-size:var(--fs-xxs); letter-spacing:.08em; text-transform:uppercase;
  color:#fff; background:rgba(0,0,0,.65);
  padding:.35rem .5rem; border-radius:6px;
  opacity:0; pointer-events:none; white-space:nowrap;
  transition:opacity .2s ease, transform .2s ease;
  filter:drop-shadow(0 2px 8px rgba(0,0,0,.35));
}
.scroll-downs:hover::after{ opacity:.95; transform:translate(-50%, -12px); }
.scroll-downs:focus-visible{ outline:2px solid #fff; outline-offset:4px; }

/* =========================================================
   BOTTOM BLUR OVERLAY
   ========================================================= */
.blur{
  position:fixed; inset:0; z-index:var(--z-blur);
  pointer-events:none; opacity:0; transition:opacity .35s ease;
}
.blur.is-visible{ opacity:1; }
.blur > div{ position:absolute; inset:0; }
.blur > div::after{
  content:""; position:absolute; inset:0 -250%;
  -webkit-backdrop-filter: blur(var(--blur, 0px)) saturate(var(--saturate, .99));
          backdrop-filter: blur(var(--blur, 0px)) saturate(var(--saturate, .99));
  -webkit-mask:linear-gradient(180deg, transparent 0 var(--maskStart, 65%), #000 100%);
          mask:linear-gradient(180deg, transparent 0 var(--maskStart, 65%), #000 100%);
}

/* =========================================================
   GOOEY CURSOR
   ========================================================= */
.gooey-cursor{
  position:fixed; inset:0; z-index:10004;
  pointer-events:none;
  filter:url(#gc-goo);
  mix-blend-mode:difference;
}
.gooey-cursor .gc-dot{
  position:absolute;
  width:var(--cursor-size,28px); height:var(--cursor-size,28px);
  border-radius:50%; background:#fff;
  transform:translate(-50%,-50%); transform-origin:50% 50%;
  will-change:transform,width,height,opacity; opacity:.95;
}
.gooey-cursor, .gooey-cursor *{ pointer-events:none; }

/* =========================================================
   TYPOGRAPHY SPECIAL
   ========================================================= */
.heading-chant{
  display:inline-flex; align-items:flex-start; gap:.35ch;
  margin:clamp(.5rem,1.2vh,1rem) 0;
  font-family:"bricolage-grotesque-48",sans-serif;
  font-weight:500; letter-spacing:-.01em; line-height:.95;
  font-size:clamp(3.4rem,6vw,3.4rem); color:var(--color-text);
  text-decoration:none; text-decoration-thickness:.08em; text-underline-offset:.12em;
  text-decoration-color:color-mix(in oklab,var(--color-text) 45%,transparent);
}
.heading-chant sup{
  font-size:.35em; line-height:0; margin-left:.3ch; letter-spacing:.04em;
  color:var(--color-text-alt); vertical-align:baseline; transform:translateY(-.6em);
}

/* Confetti trigger */
.heading-chant .confetti-sup{
  position:relative; display:inline-flex; align-items:flex-start;
  cursor:pointer; user-select:none; margin-left:.3ch; padding:0 .2ch; border-radius:.25rem; outline:0;
}
.heading-chant .confetti-sup:focus-visible{ box-shadow:0 0 0 2px rgba(255,255,255,.5); }
.heading-chant .confetti-sup .emitter{
  position:absolute; top:0; left:50%; width:0; height:0;
  transform:translate(-50%, -60%); pointer-events:none; overflow:visible; z-index:2;
}
.heading-chant .confetti-sup .emitter > div{
  position:absolute; width:8px; height:8px; background:var(--b,#fff);
  border-radius:2px; will-change:transform,opacity; mix-blend-mode:normal;
}
:root{ --confetti-colors:#FFFF04,#EA4C89,#892AB8,#4AF2FD; }
.heading-chant .confetti-sup:hover{
  text-decoration:underline; text-decoration-thickness:.08em; text-underline-offset:.12em;
  text-decoration-color:color-mix(in oklab,var(--color-text) 45%, transparent);
}

/* === Title System (unified look) === */
:root{
  --title-size-d: clamp(3rem, 6vw, 4rem);
  --title-size-m: clamp(2rem, 8.5vw, 2.6rem);
}

/* Shared “chant” look (no size here so process titles keep theirs) */
.heading-chant,
.content__title-main,
.grid-head__title,
[id$="-process"] .project--intro .project__title{
  display:inline-flex;
  align-items:flex-start;
  gap:.35ch;
  margin:clamp(.5rem,1.2vh,1rem) 0;
  font-family:"bricolage-grotesque-48",sans-serif;
  font-weight:500;
  letter-spacing:-.01em;
  line-height:.95;
  color:var(--color-text);
  text-decoration:none;
  text-decoration-thickness:.08em;
  text-underline-offset:.12em;
  text-decoration-color: color-mix(in oklab, var(--color-text) 45%, transparent);
  text-transform:none;
}

/* Size only for section/grid titles (process title keeps its own clamp) */
.heading-chant,
.content__title-main,
.grid-head__title{
  font-size:var(--title-size-d);
}

/* Sup styling for all chant titles */
.heading-chant sup,
.content__title-main sup,
.grid-head__title sup,
[id$="-process"] .project--intro .project__title sup{
  font-size:.35em;
  line-height:0;
  margin-left:.3ch;
  letter-spacing:.04em;
  color:var(--color-text-alt);
  vertical-align:baseline;
  transform:translateY(-.6em);
}

/* ---- media queries (keep with your grouped queries) ---- */
@media (max-width:768px){
  .heading-chant,
  .content__title-main,
  .grid-head__title{
    font-size:var(--title-size-m);
  }
  .heading-chant sup,
  .content__title-main sup,
  .grid-head__title sup,
  [id$="-process"] .project--intro .project__title sup{
    transform:translateY(-.5em);
  }
}

/* Blurry scroll hook */
.blur-scroll{ will-change:filter; }

/* Blackout tooltip */
.blackout{
  color:transparent; background:#fff; padding:0 .15em; border-radius:2px;
  -webkit-box-decoration-break:clone; box-decoration-break:clone;
}
.blackout.tip{ position:relative; cursor:help; }
.blackout.tip::after{
  content:attr(data-tip);
  position:absolute; bottom:100%; right:0; transform:translateY(-6px);
  background:rgba(0,0,0,0); color:#fff; padding:.45rem .55rem; border-radius:0;
  width:min(360px, 80vw); font-size:1.8em; line-height:1.2; letter-spacing:.02em;
  text-transform:none; white-space:normal; box-shadow:0 6px 18px rgba(0,0,0,0);
  opacity:0; pointer-events:none; z-index:10005; transition:opacity .15s ease, transform .15s ease;
}
.blackout.tip::before{
  content:""; position:absolute; bottom:calc(100% - 2px); right:.6rem;
  width:8px; height:8px; background:rgba(0,0,0,.88);
  transform:translateY(50%) rotate(45deg); opacity:0; transition:opacity .15s ease;
}
.blackout.tip:hover::after,
.blackout.tip:focus-visible::after{ opacity:1; transform:translateY(-10px); }
.blackout.tip:hover::before,
.blackout.tip:focus-visible::before{ opacity:1; }

/* =========================================================
   QUERY GROUP — MEDIA & FEATURE QUERIES
   (all queries collected here)
   ========================================================= */

/* Aspect ratio: keep 16:9 on wide viewports */
@media (max-aspect-ratio:16/9){
  .grid:not(.grid--zoomed){ width:100%; height:auto; aspect-ratio:16/9; }
}

/* Tablet skills: 3 → 2 columns */
@media (max-width:1024px){
  #skills .trio-grid{ grid-template-columns:repeat(2,minmax(0,1fr)); }
}

/* Mobile tuning */
@media (max-width:768px){
  :root{
    font-size:15px;
    --page-padding:1rem;
    --grid-gap:.75rem;

    /* NUANCED mobile blur */
    --blur-max: 10;   /* lighter effect reduces “sticky” state */
    --mask-stop: 20;
    --saturate: .99;  /* keep color fidelity on Android/Brave */
  }


/* Backdrop-filter reset helper (we toggle this class in JS) */
.blur.bf-reset > div::after{
  -webkit-backdrop-filter: none !important;
  backdrop-filter: none !important;
}


  .frame{
    height:auto;
    grid-template-columns:1fr;
    grid-template-rows:auto auto auto auto 1fr;
    grid-row-gap:1rem;
    align-content:start;
    padding:var(--page-padding);
  }
  .frame__title{ font-size:clamp(2.25rem,16vw,7rem); line-height:.8; }
  .frame__subline{ order:3; }
  .frame__links a{ display:inline-block; padding:.25rem 0; }

  .content--padded{ padding:var(--page-padding); }
  .content__title{ margin:2.5rem 0 1rem; }

  .content__text{ font-size:clamp(1.05rem,4.3vw,1.25rem); }

  #work{ margin-bottom:clamp(4rem,12vh,8rem); }
  #work .content__title-main{ margin-bottom:3rem; }

  .grid{
    grid-template-columns:repeat(2,1fr);
    grid-auto-rows:minmax(140px, auto);
    gap:var(--grid-gap);
    height:auto; width:100%;
  }
  .grid__img, .grid__item{ min-height:140px; }

  .grid--column{
    grid-template-columns:repeat(6,1fr);
    grid-auto-rows:minmax(140px, auto);
    gap:var(--grid-gap);
  }
  .grid--zoomed{
    grid-template-columns:repeat(2,1fr);
    grid-template-rows:auto;
    aspect-ratio:auto;
    gap:var(--grid-gap);
  }
  .grid--wide{
    grid-template-columns:repeat(2,1fr);
    grid-template-rows:auto;
  }

  [data-grid-ninth]{ grid-template-columns:repeat(2,1fr); }
  #work .grid{ grid-template-columns:repeat(2,1fr); }
  #work .grid__item{ padding:.75rem; }
  #work .grid__item h4{ font-size:.85rem; }

  .ar-wide, .ar-narrow, .ar-rect{ aspect-ratio:auto; }

  .project{ margin:12vh auto; grid-column-gap:1.25rem; }
  .project__title{ font-size:clamp(1.8rem,11vw,3.2rem); margin:6vh 0 4vh; }
  .project--details p{ max-width:none; }
  [id$="-process"]{ grid-template-columns:1fr; gap:1.25rem; }

  .intro__info{ bottom:16px; font-size:10px; opacity:.65; }

  .panel h1{ font-size:clamp(1.6rem,9vw,2.2rem); }
  .panel h2{ font-size:1.1rem; }
  .panel p{ font-size:.95rem; }
  .panel__counter h1{ font-size:.95rem; }
  .panel__progress-bar{ height:5px; }

  .panel .intro,
  .panel .hero-img,
  .panel .about,
  .panel .banner-img,
  .panel .story,
  .panel .outro{
    width:94vw; padding:1rem;
  }
  .panel .header,
  .panel .concept-img{ width:100vw; }
  .panel .about .row{ flex-direction:column; gap:1rem; }
  .panel .about .row p{ width:100%; }
  .panel .about .row .img{ aspect-ratio:16/10; }
  .panel__close{ top:.5rem; right:.5rem; padding:.4rem .6rem; }

  .page-footer{ grid-template-columns:1fr; gap:.5rem; margin-top:20vh; }

  /* Stacks: make both fit like fintech */
  .stacked-img img{
    width:100%; height:auto !important;
    object-fit:contain !important; object-position:center;
  }

  /* Fin discovery grid */
  #fintech-discovery .grid.grid--zoomed{
    grid-template-columns:repeat(2,1fr); grid-template-rows:auto;
  }

  /* Mobile tooltip */
  .blackout.tip::after{
    top:calc(100% + 10px); bottom:auto; left:50%; right:auto; transform:translate(-50%, 0);
    width:min(92vw, 420px); padding:.6rem .75rem; font-size:12.5px; line-height:1.45; text-align:center; white-space:normal;
  }
  .blackout.tip::before{
    top:100%; bottom:auto; left:50%; right:auto; transform:translate(-50%, -2px) rotate(45deg);
  }
  .blackout.tip:hover::after,
  .blackout.tip:focus-visible::after{ transform:translate(-50%, 4px); }

  /* Frame link padding tweak */
  .frame__links{ gap:.25rem .6rem; }
  .frame__links a{ padding:.2rem .45rem; }
}

/* Tiny devices */
@media (max-width:390px){
  :root{ font-size:14px; }
  .grid__img, .grid__item{ min-height:100px; padding-bottom:.5rem; }
}

/* Desktop enhancements */
@media (min-width:53em){
  :root{ --page-padding:1rem; }
  .frame{
    grid-template-columns:20% 1fr 1fr;
    grid-template-rows:min-content 1fr auto;
    grid-row-gap:15vh;
    align-items:center;
    grid-template-areas:
      "logo tags sponsor"
      "... ... subline"
      "title title title";
  }
  .frame__links{ margin-left:3rem; }
  .frame__subline{ align-self:end; }
  .frame__title{ align-self:end; }
  .frame #cdawrap{ text-align:right; max-width:250px; justify-self:end; }

  /* process: two columns, intro spans */
  [id$="-process"]{ grid-template-columns:repeat(2,minmax(0,1fr)); }
  [id$="-process"] > .project.project--intro{ grid-column:1 / -1; }

  .page-footer{ grid-template-columns:repeat(3,auto); }
}

/* Pointer contexts */
@media (pointer:fine){
  html.has-cursor body,
  html.has-cursor a,
  html.has-cursor button{ cursor:none; }
}
@media (pointer:coarse){
  .gooey-cursor{ display:none; } /* hide custom cursor on touch */
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce){
  .blur{ display:none; }
}

/* Feature queries */
@supports not ((backdrop-filter: blur(1px)) or (-webkit-backdrop-filter: blur(1px))){
  .blur{ opacity:1; }
  .blur > div::after{
    -webkit-backdrop-filter:none; backdrop-filter:none;
    background:linear-gradient(180deg, rgba(0,0,0,0) 0, rgba(0,0,0,.35) 100%);
    -webkit-mask:none; mask:none;
  }
}
@supports selector(:has(*)){
  section.content:has(.grid[data-grid-seventh]){ margin-bottom:clamp(6rem, 18vh, 22rem); }
}
@media (max-width:768px){
  @supports selector(:has(*)){
    section.content:has(.grid[data-grid-seventh]){ margin-bottom:12vh; }
  }
}
.grid[data-grid-seventh]{ margin-bottom:clamp(6rem, 18vh, 22rem); }
@media (max-width:768px){
  .grid[data-grid-seventh]{ margin-bottom:12vh; }
}

@media (max-width:768px){
  .frame{
    /* rows: logo, tags, sponsor, spacer, title-at-bottom */
    grid-template-rows: auto auto auto 1fr auto;
    align-content: stretch;
    /* exactly 50px from the viewport bottom (plus safe area on iOS) */
    padding-bottom: calc(100px + env(safe-area-inset-bottom, 0px));
  }
  .frame__title{
    align-self: end; /* keep it at the bottom row */
    margin: 0;       /* no extra spacing surprises */
  }
}


  </style>
</head>

<body class="loading">
  <main id="app"></main>
  <div class="blur"></div>
  <div id="panel-root"></div>

<script>
/* =========================================================
   APP — STRUCTURE & BEHAVIOR
   ========================================================= */

document.documentElement.classList.add('js');

(function () {
  /* -----------------------------
     Setup / helpers
  ----------------------------- */
  const has = (k) => typeof window[k] !== 'undefined';
  if (has('ScrollTrigger')) {
    if (has('Physics2DPlugin')) {
      gsap.registerPlugin(ScrollTrigger, Physics2DPlugin);
    } else {
      gsap.registerPlugin(ScrollTrigger);
    }
    ScrollTrigger.normalizeScroll(true);
  }

  const prefersReducedMotion = matchMedia('(prefers-reduced-motion: reduce)').matches;
  const $ = (s, r = document) => r.querySelector(s);
  const el = (tag, cls, html) => {
    const n = document.createElement(tag);
    if (cls) n.className = cls;
    if (html != null) n.innerHTML = html;
    return n;
  };

  /* -----------------------------
     CONTENT MODEL
  ----------------------------- */
  const CONTENT = {
    header: {
      title: 'UX is dead↴',
      logo: "ZCKGRT",
      subline: "Zack Gort — Digital Designer",
      links: [
        { label: "Short-form", href: "https://ifimaybefrank.com" },
        { label: "Résumé", href: "https://zackgort.com/resume" },
        { label: "LinkedIn", href: "https://linkedin.com/in/zackgort" }
      ],
      tags: [
        { label: "#About", href: "#about" },
        { label: "#Work", href: "#work", settle: "end" },
        { label: "#Product", href: "#fintech", settle: "end" },
        { label: "#Ecommerce", href: "#ecommerce", settle: "end"  },
        { label: "#Connect", href: "#contact", settle: "end"  }
      ]
    },

about: {
  heading: "¡Viva la XP!",
  sup: "experience",
  byline:
    "— Zack Gort, Senior <span class=\"blackout tip tip--full\" tabindex=\"0\" data-tip=\"{user} is kind of implied, no?\">User</span> Experience Designer"
},



    skills: {
      cols: [
        {
          heading: "#experience",
          items: [
            "User Experience Design",
            "Content & Brand Strategy {B2B+C}",
            "Visual Interface Design",
            "Accessibility Compliance",
            "+" 
          ]
        },
        { heading: "#savvy", items: ["Figma, Adobe CS", "HTML/CSS/Js", "Pen & Paper", "Whiteboard", "+"] },
        { heading: "#evolution", items: ["AI + Creative Coding", "Design Systems & Workflows", "+"] }
      ]
    },

    workSelect: {
      captionTitle: "select works",
      tiles: [
        "https://i.ibb.co/c3vLP47/image-445-min.png",
        "https://i.ibb.co/jJD2YPJ/image-438-min.png",
        "https://i.ibb.co/Ct9DZd9/image-442-min.png",
        "https://i.ibb.co/hsNwyLC/nav-1sec.gif",
        "https://i.ibb.co/x8Jy9P1f/11.webp"
      ],
cards: [
  { title: "BNY Mellon — Pershing X", href: "#fintech", glyph: "↓", settle: "end" },
  { title: "General Nutrition Centers {GNC}", href: "#ecommerce", glyph: "↓", settle: "end" },
  { title: "TikTok For Business", href: "https://www.tiktok.com/about?lang=en", ext: true, glyph: "↗" }
]
    },

    brandsGrid: {
      title: "#design",
      images: [
        "https://i.ibb.co/0VmJ708g/work3.webp",
        "https://i.ibb.co/kzpT2Qr/tiktok3.webp",
        "https://i.ibb.co/7J9gLTRy/mask-group-68c4867fc5153.webp",
        "https://i.ibb.co/xSVNc6mg/huge4.webp",
        "https://i.ibb.co/jk13J77g/frame-4348-68c4866f3d9d4.webp",
        "https://i.ibb.co/5XBv9TX0/dana-mobile-mockup-68c4866c20dee.webp",
        "https://i.ibb.co/qLPtQwx3/dana-mobile-68c4866ab0d77.webp",
        "https://i.ibb.co/wNWFgHj2/dana-dana-mobile-nav-68c48669d96e6.webp",
        "https://i.ibb.co/xqfFFj48/browse-location-list-68c48666baf6e.webp",
        "https://i.ibb.co/XZ8QtMx9/610811e9c2fa676f3fb1255f-zax02412-68c4866404de0.webp",
        "https://i.ibb.co/W4XvQk1t/1-vk-U8l-Zmqn-OHghe-Os-K0qtrw.webp",
        "https://i.ibb.co/0p7Ktz5L/1-Tut-Ce-PQB0b-SCo-Mf-MTWJb-Q.webp",
        "https://i.ibb.co/vxXJ7fSV/1-rqzz-Cscn-OIL96-Vm-Ln0v7d-A.webp",
        "https://i.ibb.co/VYshD42V/1-P4-Gyqav-HMmzp-A-Ehqy9g-w.webp",
        "https://i.ibb.co/MJLfbdm/1-h9lj-VOzz-RT-Irakga-DSWv-Q.webp",
        "https://i.ibb.co/ZzQnmrNr/1-GFvd-yw-Ap-PELXmtr-Fbx-Vug.webp",
        "https://i.ibb.co/RTTZh2gq/1-1-QGGK09-DGx0-R4p-d-Jg6xiw.webp",
        "https://i.ibb.co/vx76zjgf/10.webp",
        "https://i.ibb.co/rft2bf0T/9.webp",
        "https://i.ibb.co/0DPv3vQ/Frame-4349.png",
        "https://i.ibb.co/Jrb2Npd/image-020.png",
        "https://i.ibb.co/0QTSr27/dana-mobile.png",
        "https://i.ibb.co/hsNwyLC/nav-1sec.gif",
        "https://i.ibb.co/QdmJdXh/AM-wire.jpg",
        "https://i.ibb.co/68t5b9S/Mask-group-7-min.png"
      ]
    },

agencyGrid: {
  title: "#agencylife",
  images: [
    "https://i.ibb.co/LXmyD2hq/IMG-20170104-184947-650.webp",

    "https://i.ibb.co/CpkzWmRn/IMG-20151206-143245434-01.webp",
    "https://i.ibb.co/Xr97WzXX/DSC06055-1.webp",

    "https://i.ibb.co/mCK7D4Xb/1-Oen-HCQm-Ga10wp-Cz-R8o9-Pt-A.webp",
    "https://i.ibb.co/GQM6jmpJ/1-1gjr-Eff-Bio-JYo-EAv-MWHf-KQ.webp",

    "https://i.ibb.co/HpXh5NPN/IMG-20160407-150604368-1.jpg",
    "https://i.ibb.co/m5yN57gn/IMG-20160526-164803987-01.jpg",
    "https://i.ibb.co/q34v0ByL/IMG-20150419-175021862.jpg",
    "https://i.ibb.co/jkcCXSkL/IMG-20150415-134735718.jpg",

    "https://i.ibb.co/c3vLP47/image-445-min.png",
    "https://i.ibb.co/RymyPtP/image-443-min.png",
    "https://i.ibb.co/Ct9DZd9/image-442-min.png",
    "https://i.ibb.co/FgstGVs/image-441-min.png",
    "https://i.ibb.co/jJD2YPJ/image-438-min.png"
  ]
},


    fintech: {
      heroImages: [
        "https://i.ibb.co/XkM2hn8n/bny1.png",
        "https://i.ibb.co/vvMZmq94/bny2.png",
        "https://i.ibb.co/xS49C07B/bny3.png",
        "https://i.ibb.co/wZY2bhKF/bny4.png",
        "https://i.ibb.co/vvMZmq94/bny2.png"
      ],
      heroCaption: { title: " ", subtitle: " " },
  process: {
    domain: "BNY Mellon — Pershing X",
    date: "2023 — 2024",
    mission: [
      "Unify the client story {CRM}, the portfolio levers {trades, rebalancing}, and the guardrails {compliance} into a composable workspace. No tab-tennis. No hidden state.",
      "Scale from solo shops to multi-office firms. Keep accessibility and auditability first-class across high-density, real-time data."
    ],
    details: [
      [
        "Problem",
        "Advisors were playing tool-switch roulette—6–10 apps per task. Context died in handoffs, legacy UI hid critical states, and portfolio actions slowed while risk crept up."
      ],
      [
        "Constraints",
        "SEC/FINRA audit trails, gnarly permissioning, heterogeneous custodial feeds. High-density data and live prices mean cognitive load has to stay low or nothing ships."
      ],
      [
        "Role & Team",
        "Lead Product Designer {IA/flows}. Partnered with PM, Tech Lead, Data Eng, Design Ops, Compliance, plus two designers. Weekly ride-alongs with advisors and ops."
      ],
      [
        "Research",
        "Shadowed 12 advisors. Mapped task graphs—onboarding → maintenance → rebalance → review. Tree tests to settle navigation and quick actions. Notes. Lots of notes."
      ],
      [
        "Next",
        "Multi-entity households, scenario backtesting, and AI-assisted review narratives that summarize drift, cash needs, and compliance notes per meeting."
      ]
    ]
  },
      discoveryImages: [
        "https://i.ibb.co/wZY2bhKF/bny4.png",
        "https://i.ibb.co/xS49C07B/bny3.png",
        "https://i.ibb.co/vvMZmq94/bny2.png",
        "https://i.ibb.co/XkM2hn8n/bny1.png",
        "https://i.ibb.co/FJNG1jC/14.jpg",
        "https://i.ibb.co/fxjgcYD/18.png",
        "https://i.ibb.co/gtQLYJQ/17.jpg",
        "https://i.ibb.co/Fgxcqj0/16.jpg",
        "https://i.ibb.co/dcXH5fn/13.jpg"
      ],
  insight: [
    [
      "Platform & IA",
      "Composable workspace that merges CRM context with portfolio actions; permissions and auditability draw the component seams so the right things are visible to the right roles."
    ],
    [
      "Outcome",
      "Less tab tennis. Crisper states. Review + rebalance cycles tightened across dense data views—advisors stay in flow instead of searching for context."
    ]
  ],
      stack: [
        ["https://i.ibb.co/XkM2hn8n/bny1.png","BNY 1"],
        ["https://i.ibb.co/vvMZmq94/bny2.png","BNY 2"],
        ["https://i.ibb.co/xS49C07B/bny3.png","BNY 3"],
        ["https://i.ibb.co/wZY2bhKF/bny4.png","BNY 4"],
        ["https://i.ibb.co/HGv7ymj/4.jpg","Account Opening"]
      ]
    },

    ecommerce: {
      heroImages: [
        "https://i.ibb.co/cSQCgNQY/work1.webp",
        "https://i.ibb.co/spHgPH6N/1.webp",
        "https://i.ibb.co/ynjWYqv8/2.webp",
        "https://i.ibb.co/cXg5Phdc/3.webp",
        "https://i.ibb.co/gZ58PKyk/4.webp"
      ],
      heroCaption: { title: " ", subtitle: " " },
  process: {
    domain: "General Nutrition Centers",
    date: "2021",
    // one line by design
    titleLines: ["if the bar ain't bending, you’re just pretending"],
    details: [
      [
        "Problem",
        "Analytics told the story: slow releases, PLP ↔ PDP taxonomy drift, and regional content forks kneecapping SEO, conversion, and loyalty. Midway through, we called a full re-approach—contract risk on the table."
      ],
      [
        "Constraints",
        "Migrate fast to Shopify without denting SEO. Wire loyalty + ERP cleanly. Handle bundles/subscriptions without weird edge-cases. Keep mobile fast while refactoring IA."
      ],
      [
        "Role & Team",
        "Lead UX {IA/flows}. Paired with PM, Tech Lead, Shopify devs, Content, Merch, and Analytics. Tight cadence, top-tier design + strategy, weekly exec reviews."
      ],
      [
        "Research",
        "Market scans and on-site analytics, Q&Q user data, card sorts + tree tests to lock taxonomy, and wire/proto loops to vet feature bets. Notes. Lots of notes."
      ],
      [
        "Next",
        "Personalized bundles, subscription cadence tuning, and loyalty-led landing frameworks to lift AOV and repeat purchase."
      ]
    ]
  },
      discoveryImages: [
        "https://i.ibb.co/gZ58PKyk/4.webp",
        "https://i.ibb.co/cXg5Phdc/3.webp",
        "https://i.ibb.co/ynjWYqv8/2.webp",
        "https://i.ibb.co/spHgPH6N/1.webp",
        "https://i.ibb.co/Y7pGqJ69/5.webp",
        "https://i.ibb.co/99h2bQMh/6.webp",
        "https://i.ibb.co/yB4RwkTf/7.webp",
        "https://i.ibb.co/7N2rDqrN/8.webp",
        "https://i.ibb.co/rft2bf0T/9.webp",
        "https://i.ibb.co/vx76zjgf/10.webp"
      ],
  insight: [
    [
      "Outcome",
      "This is the whey: ground-up e-commerce on a considered design system—proven UX where it matters, space for ‘unproven’ where it could pay off. The result helped GNC reclaim ~\$500M in annual revenue."
    ],
    [
      "Navigation & IA",
      "Rebuilt taxonomy {goals, ingredients, formats} and aligned PLP filters to search intent. Simplified top-nav to three shopping entries plus Programs & Guidance."
    ]
  ],
      stack: [
        ["https://i.ibb.co/cSQCgNQY/work1.webp","Homepage concept"],
        ["https://i.ibb.co/spHgPH6N/1.webp","PLP & filter system"],
        ["https://i.ibb.co/ynjWYqv8/2.webp","Subscription bundle flows"],
        ["https://i.ibb.co/cXg5Phdc/3.webp","PDP content blocks"],
        ["https://i.ibb.co/gZ58PKyk/4.webp","Cart & checkout refinements"],
        ["https://i.ibb.co/Y7pGqJ69/5.webp","Landing template variants"],
        ["https://i.ibb.co/99h2bQMh/6.webp","Mobile flows"],
        ["https://i.ibb.co/yB4RwkTf/7.webp","Guides & programs"]
      ]
    },

    contact: {
      blurb: "Yeah, so if any creative teams out there are hiring, hmu. zack@reasonably.cc",
      email: "zack@reasonably.cc",
      linkedin: "https://www.linkedin.com/in/zackgort/"
    }
  };

  /* -----------------------------
     RENDERER
  ----------------------------- */
  function renderApp() {
    const app = $('#app');
    if (!app) return;

    // HEADER / FRAME
    const header = el('header','frame');
    header.innerHTML = `
      <h2 class="frame__title">
        <a class="ux-dead-jump" href="#about" aria-label="Jump to About">${CONTENT.header.title}</a>
      </h2>
      <div class="frame__subline type-tiny">
        <span>${CONTENT.header.subline}</span>
        <nav class="frame__links flex-line">
          ${CONTENT.header.links.map(l =>
            `<a href="${l.href}" ${l.href.startsWith('#')?'':`target="_blank" rel="noopener"`}>${l.label}</a>`
          ).join('')}
        </nav>
      </div>
      <nav class="frame__tags flex-line type-tiny">
        ${CONTENT.header.tags.map(t => `<a href="${t.href}" ${t.settle?`data-settle="${t.settle}"`:''}>${t.label}</a>`).join('')}
      </nav>
      <span class="frame__logo">${CONTENT.header.logo}</span>
    `;
    app.appendChild(header);

    // ABOUT
    const about = el('section','content content--padded'); about.id = 'about';
    about.innerHTML = `
      <h3 class="heading-chant">
        ${CONTENT.about.heading}
        <sup class="confetti-sup" role="button" tabindex="0" aria-label="experience (tap for confetti)">
          ${CONTENT.about.sup}
          <span class="emitter" aria-hidden="true"></span>
        </sup>
      </h3>
      <p class="type-tiny right end">${CONTENT.about.byline}</p>
    `;
    app.appendChild(about);

    // BLURRY SCROLL — inline section for speed-blur filter
    const blurSec = el('section','content content--padded blur-scroll'); blurSec.id = 'about-blur';
    blurSec.innerHTML = `
      <div class="content__title" style="margin:.25rem 0 .5rem"></div>
      <div class="content__text">
        <p>I think. I make. I think about design and data as systems. I think about how to get the best out of business requirements. I think about form and function.</p>
        <p></p>
        <p>I make things too. I've made websites for people to find money. I've made websites for people to spend money. I've made websites for people to invest money.</p>
        <p></p>
        <p>Now, as for design. I design experiences :)</p>        
      </div>
      <p class="type-tiny right end" style="margin-top:.5rem; opacity:.85;">
        Look, I didn't use AI to build this website. I found a gsap library that intrigued me, read the documentation,
        decided I saw a potential fit for the type of story I wished to tell, stripped the demo down, rebuilt it in JS
        for efficiency, added ad hoc functionality + features, idiosyncratic interactive 'easter eggs', and splashed on
        some visual fluff for good measure.
      </p>
    `;
    app.appendChild(blurSec);

    // After you've created `blurSec` in renderApp():
{
  const msg = '';
  const holder = blurSec.querySelector('.content__text');
  holder.querySelector('.blur-sig')?.remove();                 // remove old note if present
  const sig = el('p','type-tiny right end blur-sig');
  sig.textContent = msg;                                       // left-justified by your override
  holder.appendChild(sig);
}


    // SKILLS
    const skills = el('section','content content--padded'); skills.id = 'skills';
    skills.innerHTML = `
      <div class="trio-grid">
        ${CONTENT.skills.cols.map(col => `
          <div class="trio-col">
            <h4 class="type-tiny">${col.heading}</h4>
            ${col.items.map(t => `<p class="content__text">${t}</p>`).join('')}
          </div>`).join('')}
      </div>
    `;
    app.appendChild(skills);

// WORK SELECT
const work = el('section','content content--padded'); work.id='work';
work.innerHTML = `
  <h2 class="content__title-main">${CONTENT.workSelect.captionTitle}</h2>
  <div class="grid grid--columns grid--spaced" data-grid-second>
    ${CONTENT.workSelect.tiles.map(src => `<div class="grid__img" style="background-image:url(${src})"></div>`).join('')}
    ${CONTENT.workSelect.cards.map(c => `
      <div class="grid__item work-card">
        <h4 class="type-tiny">
          <a class="title-link"
             href="${c.href}"
             ${c.ext ? 'target="_blank" rel="noopener noreferrer"' : ''}
             ${c.settle ? `data-settle="${c.settle}"` : ''}>
             ${c.title}
          </a>
        </h4>
        <p>${c.glyph || ''}</p>
      </div>`).join('')}
  </div>
`;
app.appendChild(work);

// BRANDS GRID
const brands = el('section','content content--padded content--full'); brands.id='brands-grid';
brands.innerHTML = `
  <div class="grid-head">
    <div class="grid-head__title type-tiny">${CONTENT.brandsGrid.title}</div>
  </div>
  <div class="grid grid--spaced grid--small" data-grid-fifth>
    ${CONTENT.brandsGrid.images.map(src => `<div class="grid__img" style="background-image:url(${src})"></div>`).join('')}
  </div>
`;
app.appendChild(brands);


// AGENCY GRID
const agency = el('section','content content--padded content--full'); agency.id='brands-grid-2';
agency.innerHTML = `
  <div class="grid-head">
    <div class="grid-head__title type-tiny">${CONTENT.agencyGrid.title}</div>
  </div>
  <div class="grid grid--columns grid--spaced" data-grid-ninth>
    ${CONTENT.agencyGrid.images.map(src => `<div class="grid__img" style="background-image:url(${src})"></div>`).join('')}
  </div>
`;
app.appendChild(agency);




    // FINTECH — HERO
    const finHero = el('section','content content--padded content--full'); finHero.id='fintech';
    finHero.innerHTML = `
      <div class="grid grid--columns grid--spaced" data-grid-ninth>
        ${CONTENT.fintech.heroImages.map(src => `<div class="grid__img" style="background-image:url(${src})"></div>`).join('')}
      </div>
      <div class="content__title">
        <h2 class="content__title-main">${CONTENT.fintech.heroCaption.title}</h2>
        <p class="type-tiny right end">${CONTENT.fintech.heroCaption.subtitle}</p>
      </div>
    `;
    app.appendChild(finHero);

    // FINTECH — PROCESS
    const finProc = el('section','content content--padded'); finProc.id='fintech-process';
    const finIntro = `
      <section class="project project--intro">
        <span class="project__label project__label--name">Domain</span>
        <span class="project__name">${CONTENT.fintech.process.domain}</span>
        <span class="project__label project__label--date">Financial Product · Portfolio & CRM</span>
        <span class="project__date">${CONTENT.fintech.process.date}</span>
        <h2 class="project__title"><span class="project__title-line">design systems and data refactorization</span></h2>
        <span class="project__label project__label--mission">Mission</span>
        <div class="project__mission">${CONTENT.fintech.process.mission.map(p=>`<p>${p}</p>`).join('')}</div>
      </section>`;
    const finDetails = CONTENT.fintech.process.details.map(([label,text],i) => `
      <section class="project project--details ${i%2===0?'project--left':'project--right'}">
        <span class="project__label project__label--default">${label}</span>
        <p>${text}</p>
      </section>`).join('');
    finProc.innerHTML = finIntro + finDetails;
    app.appendChild(finProc);

    // FINTECH — DISCOVERY
    const finDisc = el('section','content content--full content--cutoff'); finDisc.id='fintech-discovery';
    finDisc.innerHTML = `
      <div class="grid grid--spaced grid--zoomed" data-grid-sixth>
        ${CONTENT.fintech.discoveryImages.map(src => `<div class="grid__img" style="background-image:url(${src})"></div>`).join('')}
      </div>`;
    app.appendChild(finDisc);

    // FINTECH — INSIGHT
    const finInsight = el('section','content content--padded'); finInsight.id='fintech-insight';
    finInsight.innerHTML = CONTENT.fintech.insight.map(([label,text],i)=>`
      <section class="project project--details ${i%2===0?'project--left':'project--right'}">
        <span class="project__label project__label--default">${label}</span>
        <p>${text}</p>
      </section>`).join('');
    app.appendChild(finInsight);

    // FINTECH — STACK
    const finStack = el('section','content content--full stacked-section'); finStack.id='fintech-stack';
    finStack.innerHTML = `
      <div class="stacked-gallery" data-stack>
        ${CONTENT.fintech.stack.map(([src,alt]) => `<figure class="stacked-img"><img src="${src}" alt="${alt}"></figure>`).join('')}
      </div>`;
    app.appendChild(finStack);

    // ECOM — HERO
    const ecoHero = el('section','content content--padded content--full'); ecoHero.id='ecommerce';
    ecoHero.innerHTML = `
      <div class="grid grid--columns grid--spaced" data-grid-ninth>
        ${CONTENT.ecommerce.heroImages.map(src => `<div class="grid__img" style="background-image:url(${src})"></div>`).join('')}
      </div>
      <div class="content__title">
        <h2 class="content__title-main">${CONTENT.ecommerce.heroCaption.title}</h2>
        <p class="type-tiny right end">${CONTENT.ecommerce.heroCaption.subtitle}</p>
      </div>`;
    app.appendChild(ecoHero);

    // ECOM — PROCESS
    const ecoProc = el('section','content content--padded'); ecoProc.id='ecommerce-process';
    const ecoIntro = `
      <section class="project project--intro">
        <span class="project__label project__label--name">Domain</span>
        <span class="project__name">${CONTENT.ecommerce.process.domain}</span>
        <span class="project__label project__label--date">E-commerce · Shopify</span>
        <span class="project__date">${CONTENT.ecommerce.process.date}</span>
        <h2 class="project__title">
          ${CONTENT.ecommerce.process.titleLines.map(t=>`<span class="project__title-line">${t}</span>`).join('')}
        </h2>
      </section>`;
    const ecoDetails = CONTENT.ecommerce.process.details.map(([label,text],i)=>`
      <section class="project project--details ${i%2===0?'project--left':'project--right'}">
        <span class="project__label project__label--default">${label}</span>
        <p>${text}</p>
      </section>`).join('');
    ecoProc.innerHTML = ecoIntro + ecoDetails;
    app.appendChild(ecoProc);

    // ECOM — DISCOVERY
    const ecoDisc = el('section','content content--full content--cutoff'); ecoDisc.id='ecommerce-discovery';
    ecoDisc.innerHTML = `
      <div class="grid grid--spaced grid--zoomed" data-grid-sixth>
        ${CONTENT.ecommerce.discoveryImages.map(src => `<div class="grid__img" style="background-image:url(${src})"></div>`).join('')}
      </div>`;
    app.appendChild(ecoDisc);

    // ECOM — INSIGHT
    const ecoInsight = el('section','content content--padded'); ecoInsight.id='ecommerce-insight';
    ecoInsight.innerHTML = CONTENT.ecommerce.insight.map(([label,text])=>`
      <section class="project project--details project--left">
        <span class="project__label project__label--default">${label}</span>
        <p>${text}</p>
      </section>`).join('');
    app.appendChild(ecoInsight);

    // ECOM — STACK
    const ecoStack = el('section','content content--full stacked-section'); ecoStack.id='ecommerce-stack';
    ecoStack.innerHTML = `
      <div class="stacked-gallery" data-stack>
        ${CONTENT.ecommerce.stack.map(([src,alt])=>`<figure class="stacked-img"><img src="${src}" alt="${alt}"></figure>`).join('')}
      </div>`;
    app.appendChild(ecoStack);

    // CONTACT
    const contact = el('section','content content--padded'); contact.id='contact';
    contact.innerHTML = `
      <h4 class="type-tiny">Contact</h4>
      <p class="content__text">${CONTENT.contact.blurb}</p>`;
    app.appendChild(contact);

    // FOOTER
    const footer = el('footer','page-footer type-tiny');
    footer.innerHTML = `
      <span>Hey, nice to see you down here!</span>
      <span><a href="mailto:${CONTENT.contact.email}">${CONTENT.contact.email}</a></span>
      <a href="${CONTENT.contact.linkedin}" target="_blank" rel="noopener">linkedin.com/in/zackgort</a>`;
    app.appendChild(footer);

    // Scroll-to-top widget
    const s = el('div','scroll-downs');
    s.setAttribute('role','button'); s.setAttribute('tabindex','0'); s.setAttribute('aria-label','Back to top');
    s.innerHTML = `<div class="mousey"><div class="scroller"></div></div>`;
    app.appendChild(s);
  }



function fixMobileBlurResume(){
  const blur   = document.querySelector('.blur');
  const header = document.querySelector('.frame');
  const fe     = document.querySelector('#ux-blur-fe'); // SVG scroll-speed blur

  const update = () => {
    if (!blur || !header) return;

    // 1) Reset the SVG blur (so text sections don't stay blurred)
    if (fe) gsap.set(fe, { attr: { stdDeviation: '0 0' } });

    // 2) Re-evaluate overlay visibility based on header position
    const show = header.getBoundingClientRect().bottom <= 0;
    blur.classList.toggle('is-visible', show);

    // 3) Nudge the compositor to drop any stale backdrop-filter cache
    blur.style.transition = 'none';
    // Force a reflow
    void blur.offsetHeight;
    blur.style.transition = '';

    // 4) Refresh ScrollTrigger after tab resume
    if (window.ScrollTrigger) ScrollTrigger.refresh();
  };

  // When returning to the tab (Android/Brave often resumes here)
  window.addEventListener('visibilitychange', () => {
    if (!document.hidden) setTimeout(update, 80);
  });

  // Some devices fire pageshow/focus instead
  window.addEventListener('pageshow', update);
  window.addEventListener('focus', update);
}



  /* -----------------------------
     BEHAVIOR
  ----------------------------- */
  function initSmooth() {
    if (!has('Lenis')) return;
    window.lenis = new Lenis({ lerp: 0.15 });
    window.lenis.on('scroll', () => ScrollTrigger.update());
    gsap.ticker.add((t)=>window.lenis.raf(t*1000));
    gsap.ticker.lagSmoothing(0);
  }

  function enableHashScroll() {
    document.addEventListener('click',(e)=>{
      const a = e.target.closest('a[href^="#"]'); if(!a) return;
      const id = a.getAttribute('href');
      if(!id || id.length<2) return;
      const target = document.querySelector(id); if(!target) return;
      e.preventDefault();

      const settle = a.dataset.settle;
      if (settle === 'end') {
        const st = ScrollTrigger.getAll().find(st =>
          st && (st.pin===target || st.trigger===target || target.contains(st.pin) || target.contains(st.trigger))
        );
        if (st && isFinite(st.end)) {
          const y = st.end + 2;
          return window.lenis ? window.lenis.scrollTo(y,{duration:1.1}) : window.scrollTo({top:y,behavior:'smooth'});
        }
      }
      const y = target.getBoundingClientRect().top + window.pageYOffset;
      window.lenis ? window.lenis.scrollTo(y,{duration:1}) : window.scrollTo({top:y,behavior:'smooth'});
      history.pushState(null,'',id);
    });
  }

  const preloadImages = (sel='.grid__img, .grid__img-inner') =>
    new Promise(res => imagesLoaded(document.querySelectorAll(sel), { background:true }, res));

  /* ------- TIMELINE ENGINE ------- */
  function animateGrids(){
    const mq = matchMedia('(max-width:768px)');
    const isMobile = () => mq.matches;

    const modes = {
      second: { endDesk:'+=250%', endMob:'+=140%', scrubDesk:.5,  scrubMob:.25 },
      fifth:  { endDesk:'+=250%', endMob:'+=150%', scrubDesk:.3,  scrubMob:.2  },
      sixth:  { endDesk:'+=180%', endMob:'+=120%', scrubDesk:.6,  scrubMob:.4  },
      ninth:  { endDesk:'+=210%', endMob:'+=130%', scrubDesk:.45, scrubMob:.32 }
    };

    

    function defaultEndPx(mode, grid){
      const count = grid.querySelectorAll('.grid__img').length || 6;
      const section = grid.closest('section') || grid.parentNode;
      const hasCaption = !!section.querySelector('.content__title, .grid-head');
      const cfg = ({
        second: { base:{d:220,m:140}, per:{d:10,m:7}, cap:{d:12,m:8} },
        fifth:  { base:{d:240,m:150}, per:{d: 8,m:5}, cap:{d:10,m:6} },
        sixth:  { base:{d:180,m:120}, per:{d: 6,m:4}, cap:{d:10,m:6} },
        ninth:  { base:{d:210,m:130}, per:{d: 6,m:4}, cap:{d:12,m:8} }
      })[mode] || { base:{d:200,m:120}, per:{d:6,m:4}, cap:{d:0,m:0} };

      const tilesOverMin = Math.max(0, count - 4);
      const vh = (isMobile()?cfg.base.m:cfg.base.d)
               + tilesOverMin * (isMobile()?cfg.per.m:cfg.per.d)
               + (hasCaption ? (isMobile()?cfg.cap.m:cfg.cap.d) : 0);
      return `+=${Math.round(window.innerHeight * (vh/100))}`;
    }
    const parseScrub = (v, fb) => {
      if(v==null || v==='') return fb;
      if(v==='true') return true;
      if(v==='false') return false;
      const n = parseFloat(v); return isNaN(n) ? fb : n;
    };

    const pinType = 'transform';
    const anticipate = 1.2;
    const grids = [...document.querySelectorAll(
      '[data-grid-second],[data-grid-fifth],[data-grid-sixth],[data-grid-ninth]'
    )];

    grids.forEach(grid=>{
      const imgs  = grid.querySelectorAll('.grid__img');
      const items = grid.querySelectorAll('.grid__item');
      if(!imgs.length && !items.length) return;

      const section = grid.closest('section') || grid.parentNode;
      const defaultMode =
        grid.hasAttribute('data-grid-second') ? 'second' :
        grid.hasAttribute('data-grid-fifth')  ? 'fifth'  :
        grid.hasAttribute('data-grid-sixth')  ? 'sixth'  : 'ninth';

      const d = grid.dataset;
      const mode = d.mode || defaultMode;

      const end = () => (isMobile() ? d.endMobile : d.endDesktop) || defaultEndPx(mode, grid);

      const base = modes[mode] || modes.ninth;
      const fallbackScrub = isMobile() ? base.scrubMob : base.scrubDesk;
      const scrub = parseScrub(isMobile()? d.scrubMobile : d.scrubDesktop, fallbackScrub);

      const tl = gsap.timeline({
        defaults: { ease: (mode==='sixth' ? 'none' : 'power3') },
        scrollTrigger: {
          trigger: section,
          start: 'top top',
          end,
          pin: section,
          pinType,
          pinReparent: true,
          scrub,
          anticipatePin: anticipate,
          pinSpacing: true,
          invalidateOnRefresh: true
        }
      });

      if(mode==='second'){
        const mid = Math.floor(imgs.length/2);
        tl.from(imgs,{
          stagger:{amount:.3,from:'center'},
          y:()=>innerHeight,
          transformOrigin:'50% 0%',
          rotation:(i)=> (i<mid?-1:1)*Math.abs(i-mid)*(matchMedia('(max-width:768px)').matches?1.5:3)
        }).from(items,{stagger:{amount:.3,from:'center'},yPercent:100,autoAlpha:0},0);
      }
      if(mode==='fifth'){
        tl.set(grid,{perspective:1000}).from(imgs,{
          stagger:{amount:.4,from:'random',grid:[4,9]},
          y:()=>innerHeight, rotationX:matchMedia('(max-width:768px)').matches?-40:-70,
          transformOrigin:'50% 0%', z:matchMedia('(max-width:768px)').matches?-450:-900, autoAlpha:0
        });
      }
      if(mode==='sixth'){
        tl.from(imgs,{
          stagger:{amount:.25,from:'edges',grid:[3,3]},
          scale: matchMedia('(max-width:768px)').matches ? .82 : .7,
          autoAlpha:0
        }).from(grid,{
          scale: matchMedia('(max-width:768px)').matches ? .92 : .85,
          skewY: matchMedia('(max-width:768px)').matches ? 1.5 : 3
        },0);
      }
      if(mode==='ninth'){
        const caption = section.querySelector('.content__title, .grid-head');
        tl.from(imgs,{
          transformOrigin:'100% -450%',
          stagger:.07, scaleX:1.02, skewX:matchMedia('(max-width:768px)').matches?7:15,
          xPercent:matchMedia('(max-width:768px)').matches?18:50, rotation:matchMedia('(max-width:768px)').matches?-5:-10, autoAlpha:0
        });
        if(caption) tl.from(caption,{autoAlpha:0,yPercent:40},.35);
      }
    });
  }

  function animateHeader(){
    const frame = document.querySelector('.frame');
    const title = frame?.querySelector('.frame__title');
    if(!frame||!title) return;

    if (prefersReducedMotion) {
      gsap.from(frame,{autoAlpha:0,duration:.6,ease:'power1.out',scrollTrigger:{trigger:frame,start:'top 95%'}});
      return;
    }

    gsap.timeline({
      defaults: { ease: 'none' },
      scrollTrigger: {
        trigger: frame,
        start: 'top top',
        end: 'bottom top',
        scrub: true,
        invalidateOnRefresh: true
      }
    })
    .to(frame, { opacity: 0.38, yPercent: 14 }, 0)
    .to(title, { xPercent: -80 }, 0);
  }

  function animateProcess(){
    document.querySelectorAll('[id$="-process"]').forEach(process=>{
      const intro = process.querySelector('.project--intro');
      const details = gsap.utils.toArray(process.querySelectorAll('.project--details'));
      if(prefersReducedMotion){
        intro && gsap.from(intro,{autoAlpha:0,y:16,duration:.35,scrollTrigger:{trigger:intro,start:'top 90%'}});
        details.length && gsap.from(details,{autoAlpha:0,y:14,duration:.3,stagger:.08,scrollTrigger:{trigger:process,start:'top 85%'}});
        return;
      }
      intro && gsap.from(intro,{autoAlpha:0,y:24,duration:.6,ease:'power2.out',scrollTrigger:{trigger:intro,start:'top 80%'}});
      details.length && gsap.from(details,{autoAlpha:0,y:30,duration:.5,ease:'power2.out',stagger:.12,scrollTrigger:{trigger:process,start:'top 75%',end:'bottom 30%'}});
    });
  }

  function animateStacks(){
    document.querySelectorAll('.stacked-section [data-stack]').forEach(section=>{
      const frames = section.querySelectorAll('.stacked-img');
      if(prefersReducedMotion){
        gsap.from(frames,{autoAlpha:0,y:20,duration:.4,stagger:.08,ease:'power1.out',scrollTrigger:{trigger:section,start:'top 85%'}});
        return;
      }
      frames.forEach(el=>{
        gsap.from(el,{autoAlpha:0,y:36,duration:.7,ease:'power2.out',scrollTrigger:{trigger:el,start:'top 85%'}});
        const img = el.querySelector('img');
        img && gsap.to(img,{yPercent:-8,ease:'none',scrollTrigger:{trigger:el,start:'top bottom',end:'bottom top',scrub:true}});
      });
    });
  }

  function initCursor(){
    if(!matchMedia('(pointer:fine)').matches || prefersReducedMotion) return;
    document.documentElement.classList.add('has-cursor');

    if(!document.getElementById('gc-goo-defs')){
      const svg = document.createElementNS('http://www.w3.org/2000/svg','svg');
      svg.id='gc-goo-defs'; svg.setAttribute('width','0'); svg.setAttribute('height','0');
      svg.innerHTML = `<defs><filter id="gc-goo"><feGaussianBlur in="SourceGraphic" stdDeviation="6" result="blur"/><feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 20 -10" result="goo"/><feBlend in="SourceGraphic" in2="goo"/></filter></defs>`;
      document.body.appendChild(svg);
    }

    document.querySelectorAll('.gooey-cursor').forEach(n=>n.remove());
    const wrap = document.createElement('div');
    wrap.className='gooey-cursor';
    wrap.setAttribute('aria-hidden','true');
    document.body.appendChild(wrap);

    const N = 20;
    const LERP = .35;
    const LINK_SHRINK = 0.55;
    let hoverBoost = 1;

    for (let i=0;i<N;i++){
      const d = document.createElement('div');
      d.className = 'gc-dot';
      wrap.appendChild(d);
    }
    const dots = Array.from(wrap.children);

    let mx = innerWidth/2, my = innerHeight/2;
    const hist = Array.from({length:N},()=>({x:mx,y:my}));

    addEventListener('pointermove', (e)=>{ mx=e.clientX; my=e.clientY; }, {passive:true});

    document.addEventListener('pointerover', (e)=>{
      if (e.target.closest('a[href], [role="link"]')) hoverBoost = LINK_SHRINK;
    }, true);
    document.addEventListener('pointerout', (e)=>{
      if (e.target.closest('a[href], [role="link"]')) hoverBoost = 1;
    }, true);

    function tick(){
      hist.shift(); hist.push({x:mx,y:my});
      for(let i=0;i<N;i++){
        const c = hist[i], n = hist[i+1] || hist[N-1];
        c.x += (n.x - c.x) * LERP;
        c.y += (n.y - c.y) * LERP;

        const base = i / N;
        const scale = (i === N-1) ? base * hoverBoost : base;

        dots[i].style.transform = `translate(${c.x}px, ${c.y}px) translate(-50%, -50%) scale(${scale})`;
      }
      requestAnimationFrame(tick);
    }
    requestAnimationFrame(tick);
  }

  function initConfetti(){
    const sup = document.querySelector('.heading-chant .confetti-sup'); 
    if(!sup) return;

    const emitter = sup.querySelector('.emitter');
    const physicsAvailable =
      !!(window.Physics2DPlugin || (gsap.plugins && gsap.plugins.Physics2DPlugin));
    if (!physicsAvailable) return;

    function particles(parent, qty, x, y, minA, maxA){
      const colors = ['#FFFF04','#EA4C89','#892AB8','#4AF2FD'];
      for(let i=0;i<qty;i++){
        const angle = gsap.utils.random(minA,maxA);
        const velocity = gsap.utils.random(70,140);
        const dot = document.createElement('div');
        dot.style.setProperty('--b', colors[(Math.random()*colors.length)|0]);
        parent.appendChild(dot);

        gsap.set(dot,{opacity:0,x,y,scale:gsap.utils.random(.4,.8),rotation:gsap.utils.random(0,360)});
        gsap.timeline({onComplete:()=>dot.remove()})
          .to(dot,{opacity:1,duration:.06},0)
          .to(dot,{
            duration:1.8,
            rotationX:`-=${gsap.utils.random(720,1440)}`,
            rotationZ:`+=${gsap.utils.random(720,1440)}`,
            physics2D:{angle,velocity,gravity:120}
          },0)
          .to(dot,{opacity:0,duration:1},.8);
      }
    }
    function burst(q=80,minA=-95,maxA=-35){
      particles(emitter,q,0,0,minA,maxA);
      gsap.fromTo(sup,{scale:.96},{scale:1,duration:.25,ease:'elastic.out(1,.6)'});
    }

    sup.addEventListener('click',()=>burst());
    sup.addEventListener('keydown',(e)=>{ if(e.key==='Enter'||e.key===' '){e.preventDefault();burst();}});

    if(!prefersReducedMotion && matchMedia('(pointer:fine)').matches){
      let last=0; const CD=700;
      sup.addEventListener('mouseenter',()=>{
        const now=performance.now(); if(now-last<CD) return; last=now; burst(28,-100,-60);
      });
    }

    if (prefersReducedMotion) return;

    let firedAuto = false;
    const auto = () => { if (firedAuto) return; firedAuto = true; burst(54, -100, -35); };

    if (typeof ScrollTrigger !== 'undefined') {
      const triggerEl = document.getElementById('about') || sup.closest('section') || sup;
      ScrollTrigger.create({
        trigger: triggerEl,
        start: 'top 65%',
        once: true,
        onEnter: auto
      });
    }

    const isSupInView = () => {
      const r = sup.getBoundingClientRect();
      return r.top < innerHeight * 0.65 && r.bottom > 0;
    };
    if (location.hash === '#about' || isSupInView()) {
      setTimeout(auto, 400);
    }
  }

  function initDeadJump(){
    const cands = Array.from(document.querySelectorAll('.frame__title,.ux-dead-jump'));
    const sections = Array.from(document.querySelectorAll('main > section'));
    const nextSection = () => sections[0] && sections[0].id !== 'about' ? sections[0] : sections[1] || sections[0];
    function jump(){
      const t = nextSection(); if(!t) return;
      const top = t.getBoundingClientRect().top + window.scrollY;
      window.scrollTo({ top, behavior: prefersReducedMotion ? 'auto' : 'smooth' });
    }
    cands.forEach(el=>{
      el.setAttribute('role','link'); el.setAttribute('tabindex','0'); el.setAttribute('aria-label','Jump to next section');
      el.addEventListener('click',(e)=>{e.preventDefault();jump();});
      el.addEventListener('keydown',(e)=>{ if(e.key==='Enter'||e.key===' '){e.preventDefault();jump();}});
    });
  }

  function initBackToTop(){
    const el = document.querySelector('.scroll-downs'); if(!el) return;
    const toTop = (e)=>{e.preventDefault(); window.lenis ? window.lenis.scrollTo(0,{duration:1}) : window.scrollTo({top:0,behavior:'smooth'})};
    el.addEventListener('click',toTop);
    el.addEventListener('keydown',(e)=>{ if(e.key==='Enter'||e.key===' ') toTop(e);});
  }

  function a11yifyGridImages(){
    document.querySelectorAll('.grid__img').forEach(el=>{
      el.setAttribute('role','img');
      const url=(el.style.backgroundImage||'').replace(/^url\(["']?/,'').replace(/["']?\)$/,'');
      const name=url.split('/').pop()?.split('.')[0]||'';
      el.setAttribute('aria-label', name.replace(/[-_]/g,' ').trim() || 'Gallery image');
    });
  }

  /* -----------------------------
     CASE STUDY TIMING OVERRIDES
  ----------------------------- */
  function tuneCaseStudyTiming() {
    const mq = window.matchMedia('(max-width: 768px)');
    const isMobile = () => mq.matches;

    function setTiming(grid, { endDesk, endMob, scrubDesk, scrubMob, mode }) {
      if (mode) grid.dataset.mode = mode;
      if (endDesk) grid.dataset.endDesktop = endDesk;
      if (endMob)  grid.dataset.endMobile  = endMob;
      if (scrubDesk != null) grid.dataset.scrubDesktop = scrubDesk;
      if (scrubMob  != null) grid.dataset.scrubMobile  = scrubMob;
    }

    function calcEndPx(grid, { baseVH, perTileVH, minTiles = 4, captionBoostVH = 0 }) {
      const tiles = grid.querySelectorAll('.grid__img').length || minTiles;
      const tilesOverMin = Math.max(0, tiles - minTiles);
      const hasCaption = !!(grid.closest('section')?.querySelector('.content__title, .grid-head'));
      const totalVH = (isMobile() ? baseVH.mobile : baseVH.desktop)
                    + tilesOverMin * (isMobile() ? perTileVH.mobile : perTileVH.desktop)
                    + (hasCaption ? (isMobile() ? (captionBoostVH.mobile||0):(captionBoostVH.desktop||0)) : 0);
      const px = Math.round(window.innerHeight * (totalVH / 100));
      return `+=${px}`;
    }

    // BNY — HERO (steadier scrubs, sixth-like feel)
    document.querySelectorAll('#fintech [data-grid-ninth]').forEach(grid => {
      const end = calcEndPx(grid, {
        baseVH: { desktop: 120, mobile: 90 },
        perTileVH: { desktop: 10, mobile: 7 },
        captionBoostVH: { desktop: 12, mobile: 8 }
      });
      setTiming(grid, { mode: 'sixth', endDesk: end, endMob: end, scrubDesk: 0.55, scrubMob: 0.38 });
    });

    // BNY — DISCOVERY (lateral sweep)
    document.querySelectorAll('#fintech-discovery [data-grid-sixth]').forEach(grid => {
      const end = calcEndPx(grid, {
        baseVH: { desktop: 150, mobile: 110 },
        perTileVH: { desktop: 6, mobile: 4 }
      });
      setTiming(grid, { mode: 'ninth', endDesk: end, endMob: end, scrubDesk: 0.45, scrubMob: 0.32 });
    });

    // GNC — HERO
    document.querySelectorAll('#ecommerce [data-grid-ninth]').forEach(grid => {
      const end = calcEndPx(grid, {
        baseVH: { desktop: 135, mobile: 95 },
        perTileVH: { desktop: 8, mobile: 6 },
        captionBoostVH: { desktop: 10, mobile: 6 }
      });
      setTiming(grid, { endDesk: end, endMob: end, scrubDesk: 0.40, scrubMob: 0.28 });
    });

    // GNC — DISCOVERY
    document.querySelectorAll('#ecommerce-discovery [data-grid-sixth]').forEach(grid => {
      const end = calcEndPx(grid, {
        baseVH: { desktop: 160, mobile: 110 },
        perTileVH: { desktop: 5.5, mobile: 4.5 }
      });
      setTiming(grid, { endDesk: end, endMob: end, scrubDesk: 0.50, scrubMob: 0.35 });
    });
  }

  /* -----------------------------
     SCROLL SPEED BLUR (SVG filter)
  ----------------------------- */
  function ensureScrollBlurFilter(){
    if (document.getElementById('ux-blur-defs')) return;
    const svg = document.createElementNS('http://www.w3.org/2000/svg','svg');
    svg.id = 'ux-blur-defs';
    svg.setAttribute('width','0');
    svg.setAttribute('height','0');
    svg.style.position = 'absolute';
    svg.style.left = '-9999px';
    svg.innerHTML = `
      <defs>
        <filter id="ux-blur" x="-50%" y="-50%" width="200%" height="200%">
          <feGaussianBlur id="ux-blur-fe" in="SourceGraphic" stdDeviation="0 0" />
        </filter>
      </defs>
    `;
    document.body.appendChild(svg);
  }

  function initScrollSpeedBlur({
    targetSel = '.blur-scroll',   // section to blur
    feId = '#ux-blur-fe',         // <feGaussianBlur> element id
    scale = 0.30,                 // blur = abs(diff) * scale
    max = 20,                     // cap
    axis = 'y'                    // 'x' or 'y'
  } = {}) {
    const target = document.querySelector(targetSel);
    const fe = document.querySelector(feId);
    if (!target || !fe) return;

    // Apply the SVG filter to the target once.
    target.style.filter = 'url(#ux-blur)';

    // Respect reduced motion
    if (matchMedia('(prefers-reduced-motion: reduce)').matches) {
      gsap.set(fe, { attr: { stdDeviation: '0 0' } });
      return;
    }

    let lastY = window.pageYOffset || 0;
    let lastX = window.pageXOffset || 0;

    function tick(){
      const y = window.pageYOffset || 0;
      const x = window.pageXOffset || 0;

      const dy = y - lastY;
      const dx = x - lastX;
      const delta = axis === 'x' ? Math.abs(dx) : Math.abs(dy);

      const blur = Math.min(max, delta * scale);
      const dev = axis === 'x' ? `${blur.toFixed(2)} 0` : `0 ${blur.toFixed(2)}`;
      gsap.set(fe, { attr: { stdDeviation: dev } });

      lastY = y;
      lastX = x;
      requestAnimationFrame(tick);
    }
    requestAnimationFrame(tick);
  }

  /* -----------------------------
     BOOT
  ----------------------------- */
  if (!document.querySelector('#app')) {
    const main = document.createElement('main'); main.id = 'app';
    document.body.appendChild(main);
  }
  if (!document.querySelector('.blur')) {
    const b = document.createElement('div'); b.className = 'blur'; document.body.appendChild(b);
  }
  if (!document.querySelector('#panel-root')) {
    const p = document.createElement('div'); p.id = 'panel-root'; document.body.appendChild(p);
  }

  renderApp();
  initSmooth();
  enableHashScroll();

  // Case-study timings BEFORE building triggers
  tuneCaseStudyTiming();

  // Build + run after images settle
  preloadImages().then(()=>{
    document.body.classList.remove('loading');
    animateHeader();
    animateGrids();
    animateProcess();
    animateStacks();
    initCursor();
    initConfetti();
    initDeadJump();
    initBackToTop();
    a11yifyGridImages();
    ensureScrollBlurFilter();
    initScrollSpeedBlur();
    ScrollTrigger.refresh(true);
    window.scrollTo(0,0);
  });

  // Keep timings fresh on breakpoint changes
  const mq = window.matchMedia('(max-width: 768px)');
  const onBPChange = () => { tuneCaseStudyTiming(); ScrollTrigger.refresh(); };
  if (mq.addEventListener) mq.addEventListener('change', onBPChange);
  else if (mq.addListener) mq.addListener(onBPChange);

  addEventListener('resize', ()=>ScrollTrigger.refresh());
})();
</script>

<script>
/* =========================================================
   BOTTOM BLUR OVERLAY BOOTSTRAP
   ========================================================= */
document.addEventListener('DOMContentLoaded', () => {
  const cs = getComputedStyle(document.documentElement);
  const layers   = +cs.getPropertyValue('--layers')?.trim()    || 5;
  const blurMax  = +cs.getPropertyValue('--blur-max')?.trim()  || 40;
  const maskStop = +cs.getPropertyValue('--mask-stop')?.trim() || 35;

  let blur = document.querySelector('.blur');
  if (!blur) {
    blur = document.createElement('div');
    blur.className = 'blur';
    document.body.appendChild(blur);
  }

  if (!blur.children.length) {
    let html = '';
    for (let i = 1; i <= layers; i++) {
      const t     = i / layers;
      const blurV = Math.sin((1 - t) * Math.PI / 2) * blurMax;
      const stop  = Math.sin(t * Math.PI / 2) * maskStop;
      const start = (100 - stop).toFixed(4) + '%';
      html += `<div style="--i:${i}; --blur:${blurV.toFixed(3)}px; --maskStart:${start}"></div>`;
    }
    blur.innerHTML = html;
  }

  const header = document.querySelector('.frame');
  const show = () => blur.classList.add('is-visible');
  const hide = () => blur.classList.remove('is-visible');

  if (window.ScrollTrigger && header) {
    ScrollTrigger.create({
      trigger: header,
      start: 'bottom top',
      onEnter: show,
      onEnterBack: hide,
      onLeaveBack: hide
    });
  } else if (header) {
    const io = new IntersectionObserver(([entry]) => entry.isIntersecting ? hide() : show(), { threshold: 0 });
    io.observe(header);
  }

  // If the page loads already scrolled past the header, ensure blur shows.
  if (header && header.getBoundingClientRect().bottom <= 0) show();
});
</script>



</body>
</html>
